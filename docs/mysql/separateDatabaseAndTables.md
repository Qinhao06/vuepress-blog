# 分库分表

当 mysql 单表数据过多时就设计到进行分库分表操作。将表部署到不同的集群之中，查询时就能进行多路查询，提高查询速度。

## 水平切分

水平切分又称为 Sharding，它是将同一个表中的记录拆分到多个结构相同的表中。

当一个表的数据不断增多时，Sharding 是必然的选择，它可以将数据分布到集群的不同节点上，从而缓存单个数据库的压力。

![img](https://s2.loli.net/2023/12/08/KEdkcMWN81PprwQ.jpg)

## 垂直切分

![img](https://s2.loli.net/2023/12/08/CfUWO4uPLHQzn5V.jpg)

垂直切分是将一张表按列切分成多个表，通常是按照列的关系密集程度进行切分，也可以利用垂直切分将经常被使用的列和不经常被使用的列切分到不同的表中。

在数据库的层面使用垂直切分将按数据库中表的密集程度部署到不同的库中，例如将原来的电商数据库垂直切分成商品数据库、用户数据库等

## Sharding 策略

通过映射将不同的数据存储到不同的数据库中，使用时再根据映射获取对应的数据。

不同映射策略：

- 哈希取模: hash(key) % NUM_DB
- 范围: 可以是 ID 范围也可以是时间范围
- 映射表: 使用单独的一个数据库来存储映射关系

